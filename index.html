<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BQ2A | THE TABLE</title>
    <style>
        body { margin: 0; background-color: #050505; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        .info { position: absolute; top: 10px; width: 100%; text-align: center; color: #00f2ff; font-family: monospace; pointer-events: none; }
    </style>
</head>
<body>

    <div class="info">PROJECT BQ2A: 3D TABLE RENDER</div>
    <canvas id="application-canvas"></canvas>

    <script src="https://code.playcanvas.com/playcanvas-stable.min.js"></script>

    <script>
        const canvas = document.getElementById('application-canvas');
        const app = new pc.Application(canvas, {
            mouse: new pc.Mouse(canvas),
            touch: new pc.TouchDevice(canvas)
        });

        app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);
        app.setCanvasResolution(pc.RESOLUTION_AUTO);
        app.start();

        // إعداد الكاميرا بزاوية رؤية علوية (Isometric)
        const camera = new pc.Entity('camera');
        camera.addComponent('camera', { clearColor: new pc.Color(0.1, 0.1, 0.1) });
        app.root.addChild(camera);
        camera.setPosition(4, 4, 4);
        camera.lookAt(0, 0, 0);

        // إضاءة قوية لإظهار الظلال
        const light = new pc.Entity('light');
        light.addComponent('light', {
            type: 'directional',
            color: new pc.Color(1, 1, 1),
            castShadows: true,
            shadowBias: 0.05,
            normalOffsetBias: 0.05
        });
        light.setEulerAngles(45, 45, 0);
        app.root.addChild(light);

        // --- بناء الطاولة ---
        
        // 1. سطح الطاولة
        const tableTop = new pc.Entity('TableTop');
        tableTop.addComponent('render', { type: 'box' });
        tableTop.setLocalScale(4, 0.2, 2.5); // عريضة ومسطحة
        tableTop.setPosition(0, 1, 0);
        
        const woodMaterial = new pc.StandardMaterial();
        woodMaterial.diffuse = new pc.Color(0.4, 0.2, 0.1); // لون خشبي
        woodMaterial.shininess = 30;
        woodMaterial.update();
        tableTop.render.meshInstances[0].material = woodMaterial;
        app.root.addChild(tableTop);

        // 2. دالة لإنشاء أرجل الطاولة
        function createLeg(x, z) {
            const leg = new pc.Entity('Leg');
            leg.addComponent('render', { type: 'cylinder' });
            leg.setLocalScale(0.15, 1, 0.15);
            leg.setPosition(x, 0.5, z);
            leg.render.meshInstances[0].material = woodMaterial;
            app.root.addChild(leg);
        }

        // وضع الأرجل في الزوايا الأربعة
        createLeg(1.8, 1.1);
        createLeg(-1.8, 1.1);
        createLeg(1.8, -1.1);
        createLeg(-1.8, -1.1);

        // 3. إضافة أرضية لاستقبال الظلال
        const floor = new pc.Entity('Floor');
        floor.addComponent('render', { type: 'plane' });
        floor.setLocalScale(10, 1, 10);
        app.root.addChild(floor);

        // تحريك الكاميرا باللمس لرؤية الطاولة من كل الزوايا
        if (app.touch) {
            app.touch.on(pc.EVENT_TOUCHMOVE, (e) => {
                app.root.findByName('TableTop').rotate(0, e.touches[0].dx, 0);
            });
        }

        app.on('update', dt => {
            // دوران خفيف للمشهد بالكامل
            // app.root.rotate(0, 10 * dt, 0);
        });

        window.addEventListener('resize', () => app.resizeCanvas());
    </script>
</body>
</html>
